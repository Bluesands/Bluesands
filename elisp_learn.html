<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2017-11-29 三 17:27 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>&lrm;</title>
<meta name="generator" content="Org mode" />
<link rel="stylesheet" title="Standard" href="/worg/style/worg.css" type="text/css" />
<link rel="alternate stylesheet" title="Zenburn" href="/worg/style/worg-zenburn.css" type="text/css" />
<link rel="alternate stylesheet" title="Classic" href="/worg/style/worg-classic.css" type="text/css" />
</head>
<body>
<div id="org-div-home-and-up">
 <a accesskey="h" href="index.html"> UP </a>
 |
 <a accesskey="H" href="index.html"> HOME </a>
</div><div id="content">
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org4e1737f">Emacs Lisp 简明教程</a>
<ul>
<li><a href="#orgb9f6b33">基础知识</a>
<ul>
<li><a href="#org3c2da8e">函数与变量</a></li>
<li><a href="#orged83e28">局部作用域的变量</a></li>
<li><a href="#orgcf40471">lambda 表达式</a></li>
<li><a href="#orgdaebf1a">控制结构</a></li>
</ul>
</li>
<li><a href="#orgc7e0682">基本数据类型</a>
<ul>
<li><a href="#org6014573">数字</a></li>
<li><a href="#org5244081">字符和字符串</a></li>
<li><a href="#orgf995c44">数组和序列</a></li>
<li><a href="#org4bf2365">符号</a></li>
</ul>
</li>
<li><a href="#org51b604b">求值规则</a></li>
<li><a href="#orge8da8e3">变量</a></li>
<li><a href="#org97fe0ac">函数和命令</a></li>
<li><a href="#orge274feb">正则表达式</a></li>
<li><a href="#orge9fb1cd">操作对象</a>
<ul>
<li><a href="#orgbaf56eb">缓冲区</a></li>
<li><a href="#org61d8915">窗口</a></li>
<li><a href="#orgd05c605">文件</a></li>
<li><a href="#orgf62a80d">文本</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="outline-container-org4e1737f" class="outline-2">
<h2 id="org4e1737f">Emacs Lisp 简明教程</h2>
<div class="outline-text-2" id="text-org4e1737f">
<p>
该教程是<a href="http://smacs.github.io/elisp/">叶文彬写的 Emacs Lisp 的教程</a>，在这里记录学习笔记。
</p>
</div>
<div id="outline-container-orgb9f6b33" class="outline-3">
<h3 id="orgb9f6b33">基础知识</h3>
<div class="outline-text-3" id="text-orgb9f6b33">
</div>
<div id="outline-container-org3c2da8e" class="outline-4">
<h4 id="org3c2da8e">函数与变量</h4>
<div class="outline-text-4" id="text-org3c2da8e">
<p>
elisp 定义一个函数形式如下：
</p>
<div class="org-src-container">
<pre class="src src-elisp"><span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">defun</span> <span style="color: #bc6ec5; font-weight: bold;">function-name</span> <span style="color: #bc6ec5;">(</span>arguments-list<span style="color: #bc6ec5;">)</span>
<span style="color: #2aa1ae;">"document string"</span>
body<span style="color: #4f97d7;">)</span>
</pre>
</div>
<p>
example:
</p>
<div class="org-src-container">
<pre class="src src-elisp"><span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">defun</span> <span style="color: #bc6ec5; font-weight: bold;">hello-word</span> <span style="color: #bc6ec5;">(</span>name<span style="color: #bc6ec5;">)</span>
<span style="color: #2aa1ae;">"Say hello to user whose name is Name."</span>
<span style="color: #bc6ec5;">(</span>message <span style="color: #2d9574;">"Hello, %s"</span> name<span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)</span>
<span style="color: #4f97d7;">(</span>hello-word <span style="color: #2d9574;">"Bluesands"</span><span style="color: #4f97d7;">)</span>
</pre>
</div>

<p>
可以使用 C-h f 输入函数名查看函数帮助。每个函数都有一个返回值，这个返回值一般是函数定义里的最后一个表达式的值。
</p>

<p>
elisp 里的变量使用无需像 c 语言那样需要声明，你可以使用 setq 直接对一个变量赋值。
</p>
<div class="org-src-container">
<pre class="src src-elisp"><span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">setq</span> foo <span style="color: #2d9574;">"I'm foo"</span><span style="color: #4f97d7;">)</span>
<span style="color: #4f97d7;">(</span>message foo<span style="color: #4f97d7;">)</span>
</pre>
</div>

<p>
可以使用 C-h v 输入变量名查看变量文档
</p>

<p>
有一个特殊的表达式(special form) defvar，它可以声明一个变量，一般形式是：
</p>
<div class="org-src-container">
<pre class="src src-elisp"><span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">defvar</span> <span style="color: #7590db;">variable-name</span> value
<span style="color: #2aa1ae;">"document string"</span><span style="color: #4f97d7;">)</span>
</pre>
</div>
<p>
它与 setq 的区别是，如果变量在声明之前已经有一个值的话，用 defvar 声明的变量不会改变成声明的值。另一个区别是 defvar 可以为变量提供文档字符串。
</p>
<div class="org-src-container">
<pre class="src src-elisp"><span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">defvar</span> <span style="color: #7590db;">foo</span> <span style="color: #2d9574;">"Did I have a value?"</span>
<span style="color: #2aa1ae;">"A demo variable"</span><span style="color: #4f97d7;">)</span>
foo
</pre>
</div>

<p>
由于 elisp 中函数是全局的，变量也很容易成为全局变量（因为全局变量和局部变量的赋值都是使用 setq 函数），名字不互为冲突是很关键的。所以除了为你的函数和变量选择一个合适的前缀之外，用 C-h f 和 C-h v 查看一下函数名和变量名有没有被使用过是很关键的。
</p>
</div>
</div>
<div id="outline-container-orged83e28" class="outline-4">
<h4 id="orged83e28">局部作用域的变量</h4>
<div class="outline-text-4" id="text-orged83e28">
<p>
如果没有局部作用域的变量，都使用全局变量，函数会相当难写，elisp 使用 let 和 let*进行局部变量绑定。 
</p>
<div class="org-src-container">
<pre class="src src-elisp"><span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">let</span> <span style="color: #bc6ec5;">(</span>bindings<span style="color: #bc6ec5;">)</span>
body<span style="color: #4f97d7;">)</span>
</pre>
</div>
<p>
bindings 可以是(var value)这样对 var 赋初始值，或则使用 var 声明一个初始值为 nil 的变量。
</p>
<div class="org-src-container">
<pre class="src src-elisp"><span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">defun</span> <span style="color: #bc6ec5; font-weight: bold;">circls-area</span> <span style="color: #bc6ec5;">(</span>radix<span style="color: #bc6ec5;">)</span>
<span style="color: #bc6ec5;">(</span><span style="color: #4f97d7; font-weight: bold;">let</span> <span style="color: #2d9574;">(</span><span style="color: #67b11d;">(</span>pi <span style="color: #a45bad;">3.1415929</span><span style="color: #67b11d;">)</span>
area<span style="color: #2d9574;">)</span>
<span style="color: #2d9574;">(</span><span style="color: #4f97d7; font-weight: bold;">setq</span> area <span style="color: #67b11d;">(</span>* pi radix radix<span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span>
<span style="color: #2d9574;">(</span>message <span style="color: #2d9574;">"&#30452;&#24452;%.2f &#30340;&#22278;&#38754;&#31215;&#26159;%.2f"</span> radix area<span style="color: #2d9574;">)</span><span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)</span>
<span style="color: #4f97d7;">(</span>circls-area <span style="color: #a45bad;">3</span><span style="color: #4f97d7;">)</span>
</pre>
</div>

<p>
let*和 let 的形式完全相同，区别是 let*声明中可以是使用前面声明过的变量：
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">defun</span> <span style="color: #bc6ec5; font-weight: bold;">circls-area</span> <span style="color: #bc6ec5;">(</span>radix<span style="color: #bc6ec5;">)</span>
<span style="color: #bc6ec5;">(</span><span style="color: #4f97d7; font-weight: bold;">let*</span> <span style="color: #2d9574;">(</span><span style="color: #67b11d;">(</span>pi <span style="color: #a45bad;">3.1415926</span><span style="color: #67b11d;">)</span>
<span style="color: #67b11d;">(</span>area <span style="color: #b1951d;">(</span>* pi radix radix<span style="color: #b1951d;">)</span><span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span>
<span style="color: #2d9574;">(</span>message <span style="color: #2d9574;">"&#30452;&#24452;%.2f &#30340;&#22278;&#38754;&#31215;&#26159;%.2f"</span> radix area<span style="color: #2d9574;">)</span><span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)</span>
<span style="color: #4f97d7;">(</span>circls-area <span style="color: #a45bad;">3</span><span style="color: #4f97d7;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-orgcf40471" class="outline-4">
<h4 id="orgcf40471">lambda 表达式</h4>
<div class="outline-text-4" id="text-orgcf40471">
<p>
可能你久闻 lambda 表达式的大名了，其实 lambda 表达式相当与其他语言的匿名函数：
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">lambda</span> <span style="color: #bc6ec5;">(</span>arguments-list<span style="color: #bc6ec5;">)</span>
<span style="color: #2aa1ae;">"documentation string"</span>
body<span style="color: #4f97d7;">)</span>
</pre>
</div>
<p>
lambda 使用实例：
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #4f97d7;">(</span>funcall <span style="color: #bc6ec5;">(</span><span style="color: #4f97d7; font-weight: bold;">lambda</span> <span style="color: #2d9574;">(</span>name<span style="color: #2d9574;">)</span>
<span style="color: #2d9574;">(</span>message <span style="color: #2d9574;">"Hello, %s!"</span> name<span style="color: #2d9574;">)</span><span style="color: #bc6ec5;">)</span> <span style="color: #2d9574;">"Emacser"</span><span style="color: #4f97d7;">)</span>
</pre>
</div>
<p>
或者将 lambda 表达式赋值给一个变量，然后 funcall 调用：
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">setq</span> foo <span style="color: #bc6ec5;">(</span><span style="color: #4f97d7; font-weight: bold;">lambda</span> <span style="color: #2d9574;">(</span>name<span style="color: #2d9574;">)</span>
<span style="color: #2d9574;">(</span>message <span style="color: #2d9574;">"Hello, %s!"</span> name<span style="color: #2d9574;">)</span><span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)</span>
<span style="color: #4f97d7;">(</span>funcall foo <span style="color: #2d9574;">"Emacser"</span><span style="color: #4f97d7;">)</span>
</pre>
</div>
<p>
lambda 表达式最常用的作用是作为参数传递给其他函数，比如 mapc。
</p>
</div>
</div>

<div id="outline-container-orgdaebf1a" class="outline-4">
<h4 id="orgdaebf1a">控制结构</h4>
<div class="outline-text-4" id="text-orgdaebf1a">
<p>
顺序执行一般来说程序都是按表达式顺序依次执行的，这在 defun 特殊环境中是自动执行的。但是一般情况下都不是这样的，比如你无法用 eval-last-sexp 同时执行两个表达式，在 if 表达式中的条件为真执行的部分也只能运行一个表达式。这时就需要用 progn 这个特殊的表达式，它的使用形式如下：
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">progn</span> A B C ...<span style="color: #4f97d7;">)</span>
</pre>
</div>
<p>
它的作用就是让表达式 A,B,C 顺序执行。比如：
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">progn</span>
<span style="color: #bc6ec5;">(</span><span style="color: #4f97d7; font-weight: bold;">setq</span> foo <span style="color: #a45bad;">3</span><span style="color: #bc6ec5;">)</span>
<span style="color: #bc6ec5;">(</span>message <span style="color: #2d9574;">"Square of %d is %d"</span> foo <span style="color: #2d9574;">(</span>* foo foo<span style="color: #2d9574;">)</span><span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)</span>
</pre>
</div>

<p>
条件判断
elisp 有连个最基本的条件判断表达式 if 和 cond。使用形式分别如下：
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">if</span> condition
then
else<span style="color: #4f97d7;">)</span>
<span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">cond</span> <span style="color: #bc6ec5;">(</span>case1 do-when-case1<span style="color: #bc6ec5;">)</span>
<span style="color: #bc6ec5;">(</span>case2 do-when-case2<span style="color: #bc6ec5;">)</span>
...
<span style="color: #bc6ec5;">(</span>t do-when-none-meet<span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)</span>
</pre>
</div>
<p>
使用实例如下：
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">    <span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">defun</span> <span style="color: #bc6ec5; font-weight: bold;">my-max</span> <span style="color: #bc6ec5;">(</span>a b<span style="color: #bc6ec5;">)</span>
      <span style="color: #bc6ec5;">(</span><span style="color: #4f97d7; font-weight: bold;">if</span> <span style="color: #2d9574;">(</span>&gt; a b<span style="color: #2d9574;">)</span>
          a b<span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)</span>
    <span style="color: #4f97d7;">(</span>my-max <span style="color: #a45bad;">3</span> <span style="color: #a45bad;">4</span><span style="color: #4f97d7;">)</span>

<span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">defun</span> <span style="color: #bc6ec5; font-weight: bold;">fib</span> <span style="color: #bc6ec5;">(</span>n<span style="color: #bc6ec5;">)</span>
  <span style="color: #bc6ec5;">(</span><span style="color: #4f97d7; font-weight: bold;">cond</span> <span style="color: #2d9574;">(</span><span style="color: #67b11d;">(</span>= n <span style="color: #a45bad;">0</span><span style="color: #67b11d;">)</span> <span style="color: #a45bad;">0</span><span style="color: #2d9574;">)</span>
        <span style="color: #2d9574;">(</span><span style="color: #67b11d;">(</span>= n <span style="color: #a45bad;">1</span><span style="color: #67b11d;">)</span> <span style="color: #a45bad;">1</span><span style="color: #2d9574;">)</span>
        <span style="color: #2d9574;">(</span>t <span style="color: #67b11d;">(</span>+ <span style="color: #b1951d;">(</span>fib <span style="color: #4f97d7;">(</span>- n <span style="color: #a45bad;">1</span><span style="color: #4f97d7;">)</span><span style="color: #b1951d;">)</span>
              <span style="color: #b1951d;">(</span>fib <span style="color: #4f97d7;">(</span>- n <span style="color: #a45bad;">2</span><span style="color: #4f97d7;">)</span><span style="color: #b1951d;">)</span><span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span><span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)</span>
<span style="color: #4f97d7;">(</span>fib <span style="color: #a45bad;">10</span><span style="color: #4f97d7;">)</span>
</pre>
</div>
<p>
还有两个宏 when 和 unless，从它们的名字就知道它们是什么用的。使用这两个宏的好处是使代码可读性提高，when 能省去 if 里的 progn 结构，unless 省去条件为真子句需要的 nil 表达式。
</p>

<p>
循环使用循环 while 表达式：
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">while</span> condition
  body<span style="color: #4f97d7;">)</span>
</pre>
</div>
<p>
实例：
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">defun</span> <span style="color: #bc6ec5; font-weight: bold;">factorial</span> <span style="color: #bc6ec5;">(</span>n<span style="color: #bc6ec5;">)</span>
  <span style="color: #bc6ec5;">(</span><span style="color: #4f97d7; font-weight: bold;">let</span> <span style="color: #2d9574;">(</span><span style="color: #67b11d;">(</span>res <span style="color: #a45bad;">1</span><span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span>
    <span style="color: #2d9574;">(</span><span style="color: #4f97d7; font-weight: bold;">while</span> <span style="color: #67b11d;">(</span>&gt; n <span style="color: #a45bad;">1</span><span style="color: #67b11d;">)</span>
      <span style="color: #67b11d;">(</span><span style="color: #4f97d7; font-weight: bold;">setq</span> res <span style="color: #b1951d;">(</span>* res n<span style="color: #b1951d;">)</span>
            n <span style="color: #b1951d;">(</span>- n <span style="color: #a45bad;">1</span><span style="color: #b1951d;">)</span><span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span>
    res<span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)</span>
<span style="color: #4f97d7;">(</span>factorial <span style="color: #a45bad;">10</span><span style="color: #4f97d7;">)</span>
</pre>
</div>

<p>
逻辑运算条件的逻辑运算和其他语言都是很类似的，使用 and、or、not。and 和 or 同样具有短路性质。很多人喜欢在表达式短时，用 and 代替 when，or 代替 unless。当然这时一般不关心它们的返回值，而是在于表达式其它子句的副作用。比如 or 经常用于设置函数的缺省值，而 and 常用与参数检查：
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">defun</span> <span style="color: #bc6ec5; font-weight: bold;">hello-world</span> <span style="color: #bc6ec5;">(</span><span style="color: #ce537a; font-weight: bold;">&amp;optional</span> name<span style="color: #bc6ec5;">)</span>
  <span style="color: #bc6ec5;">(</span><span style="color: #4f97d7; font-weight: bold;">or</span> name <span style="color: #2d9574;">(</span><span style="color: #4f97d7; font-weight: bold;">setq</span> name <span style="color: #2d9574;">"Emacser"</span><span style="color: #2d9574;">)</span><span style="color: #bc6ec5;">)</span>
  <span style="color: #bc6ec5;">(</span>message <span style="color: #2d9574;">"Hello, %s"</span> name<span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)</span>

<span style="color: #4f97d7;">(</span>hello-world<span style="color: #4f97d7;">)</span>
<span style="color: #4f97d7;">(</span>hello-world <span style="color: #2d9574;">"Ye"</span><span style="color: #4f97d7;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgc7e0682" class="outline-3">
<h3 id="orgc7e0682">基本数据类型</h3>
<div class="outline-text-3" id="text-orgc7e0682">
</div>
<div id="outline-container-org6014573" class="outline-4">
<h4 id="org6014573">数字</h4>
<div class="outline-text-4" id="text-org6014573">
<p>
emacs 的数字分为整数和浮点数（没有 c 的双精度数 double），其中 integer 可以使用 most-positive-fixnum 和 most-negative-fixnum 两个变量得到范围；float 可以使用 most-positive-float 和 most-negative-float 得到范围。
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #4f97d7;">(</span>princ <span style="color: #bc6ec5;">(</span>format <span style="color: #2d9574;">"This machine integer max is %d and min is %d.\n"</span> most-positive-fixnum most-negative-fixnum<span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)</span>
<span style="color: #4f97d7;">(</span>princ <span style="color: #bc6ec5;">(</span>format <span style="color: #2d9574;">"This machine float max is %s and min is %s."</span> most-positive-float most-negative-float<span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)</span>
</pre>
</div>

<p>
测试函数整数类型测试函数是 integerp，浮点数类型测试函数是 floatp。数字类型测试用 numberp。你可以分别运行这几个例子来试验一下：
</p>
<pre class="example">
t
nil
nil
t
t

</pre>
<p>
还提供一些特殊测试，比如测试零的 zerop，还有非负整数测试的 wholenump。
elisp 测试函数一般都是用 p 结尾，p 是 predicate 的第一个字母，如果函数名是一个单词，通常只是在这个单词后加一个 p，如果是多个单词，一般是加-p。
</p>
</div>
</div>
<div id="outline-container-org5244081" class="outline-4">
<h4 id="org5244081">字符和字符串</h4>
<div class="outline-text-4" id="text-org5244081">
<p>
大小写转换使用的是 downcase 和 upcase 两个函数。这两个函数的参数既可以字符串，也可以是字符。capitalize 可以使字符串中单词的地一个字符大写，其他字符消协。upcase-initials 只使第一个单词的第一个字符大写，其他字符小写。这两个函数的参数如果是一个字符，那么只让这个字符大写。
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #4f97d7;">(</span>prin1 <span style="color: #bc6ec5;">(</span>downcase <span style="color: #2d9574;">"The cat is the hat"</span><span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)</span>
<span style="color: #4f97d7;">(</span>print <span style="color: #bc6ec5;">(</span>downcase ?X<span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)</span>
<span style="color: #4f97d7;">(</span>prin1 <span style="color: #bc6ec5;">(</span>upcase <span style="color: #2d9574;">"The cat in the hat"</span><span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)</span>
<span style="color: #4f97d7;">(</span>print <span style="color: #bc6ec5;">(</span>upcase ?X<span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)</span>
<span style="color: #4f97d7;">(</span>prin1 <span style="color: #bc6ec5;">(</span>capitalize <span style="color: #2d9574;">"The CAT in tHe hat"</span><span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)</span>
<span style="color: #4f97d7;">(</span>print <span style="color: #bc6ec5;">(</span>upcase-initials <span style="color: #2d9574;">"The CAT in the hAt"</span><span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)</span>
</pre>
</div>

<p>
格式化字符串
format 类似与 c 语言里的 printf 可以实现对象的字符串化。数字的格式化和 printf 的参数差不多，值得一提的是"%s"这个格式化形式，它可以把对象的输出形式转化成字符串，这在调试时很有用。查找和替换字符串查找的核心函数是 string-match。这个函数可以从指定的位置对字符串进行正则表达式匹配，如果匹配成功，则返回匹配的起点：
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #4f97d7;">(</span>prin1 <span style="color: #bc6ec5;">(</span>string-match <span style="color: #2d9574;">"34"</span> <span style="color: #2d9574;">"01234567890123456789"</span><span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)</span>
<span style="color: #4f97d7;">(</span>print <span style="color: #bc6ec5;">(</span>string-match <span style="color: #2d9574;">"34"</span> <span style="color: #2d9574;">"01234567890123456789"</span> <span style="color: #a45bad;">10</span><span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)</span>
</pre>
</div>
<p>
注意 string-match 的采纳书是一个 regexp。emacs 好像没有内建的查找子串的函数。如果你想把 string-match 作为一个查找子串的函数，可以先用 regexp-quote 函数处理一下子串。
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #4f97d7;">(</span>prin1 <span style="color: #bc6ec5;">(</span>string-match <span style="color: #2d9574;">"2*"</span> <span style="color: #2d9574;">"232*=696"</span><span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)</span>
<span style="color: #4f97d7;">(</span>print <span style="color: #bc6ec5;">(</span>string-match <span style="color: #2d9574;">(</span>regexp-quote <span style="color: #2d9574;">"2*"</span><span style="color: #2d9574;">)</span> <span style="color: #2d9574;">"232*=696"</span><span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)</span>
</pre>
</div>

<p>
string-match 在查找的同时，还会记录下每个要捕捉的字符串的位置。这个位置可以在匹配后用 match-data、match-beginning 和 match-end 等函数来获得。
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">progn</span>
  <span style="color: #bc6ec5;">(</span>string-match <span style="color: #2d9574;">"3</span><span style="color: #2d9574; font-weight: bold;">\\</span><span style="color: #2d9574; font-weight: bold;">(</span><span style="color: #2d9574;">4</span><span style="color: #2d9574; font-weight: bold;">\\</span><span style="color: #2d9574; font-weight: bold;">)</span><span style="color: #2d9574;">"</span> <span style="color: #2d9574;">"01234567890123456789"</span><span style="color: #bc6ec5;">)</span>
  <span style="color: #bc6ec5;">(</span>match-data<span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">let</span> <span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">(</span>start <span style="color: #a45bad;">0</span><span style="color: #2d9574;">)</span><span style="color: #bc6ec5;">)</span>
  <span style="color: #bc6ec5;">(</span><span style="color: #4f97d7; font-weight: bold;">while</span> <span style="color: #2d9574;">(</span>string-match <span style="color: #2d9574;">"34"</span> <span style="color: #2d9574;">"01234567890123456789"</span> start<span style="color: #2d9574;">)</span>
    <span style="color: #2d9574;">(</span>princ <span style="color: #67b11d;">(</span>format <span style="color: #2d9574;">"find at %d\n"</span> <span style="color: #b1951d;">(</span>match-beginning <span style="color: #a45bad;">0</span><span style="color: #b1951d;">)</span><span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span>
    <span style="color: #2d9574;">(</span><span style="color: #4f97d7; font-weight: bold;">setq</span> start <span style="color: #67b11d;">(</span>match-end <span style="color: #a45bad;">0</span><span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span><span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)</span>
</pre>
</div>
<p>
替换函数是 replace-match，可以用于字符串的替换，也可以用于缓冲区的文本替换，对于字符串的替换，replace-match 只是按给定的序号把字符串的那一部分用提供的字符串替换。
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">let</span> <span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">(</span>str <span style="color: #2d9574;">"01234567890123456789"</span><span style="color: #2d9574;">)</span><span style="color: #bc6ec5;">)</span>
  <span style="color: #bc6ec5;">(</span>string-match <span style="color: #2d9574;">"34"</span> str<span style="color: #bc6ec5;">)</span>
  <span style="color: #bc6ec5;">(</span>prin1 <span style="color: #2d9574;">(</span>replace-match <span style="color: #2d9574;">"x"</span> nil nil str <span style="color: #a45bad;">0</span><span style="color: #2d9574;">)</span><span style="color: #bc6ec5;">)</span>
  <span style="color: #bc6ec5;">(</span>print str<span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)</span>
</pre>
</div>

<pre class="example">
"012x567890123456789"
"01234567890123456789"

</pre>
</div>
</div>

<div id="outline-container-orgf995c44" class="outline-4">
<h4 id="orgf995c44">数组和序列</h4>
</div>
<div id="outline-container-org4bf2365" class="outline-4">
<h4 id="org4bf2365">符号</h4>
</div>
</div>
<div id="outline-container-org51b604b" class="outline-3">
<h3 id="org51b604b">求值规则</h3>
</div>
<div id="outline-container-orge8da8e3" class="outline-3">
<h3 id="orge8da8e3">变量</h3>
</div>
<div id="outline-container-org97fe0ac" class="outline-3">
<h3 id="org97fe0ac">函数和命令</h3>
</div>
<div id="outline-container-orge274feb" class="outline-3">
<h3 id="orge274feb">正则表达式</h3>
</div>
<div id="outline-container-orge9fb1cd" class="outline-3">
<h3 id="orge9fb1cd">操作对象</h3>
<div class="outline-text-3" id="text-orge9fb1cd">
</div>
<div id="outline-container-orgbaf56eb" class="outline-4">
<h4 id="orgbaf56eb">缓冲区</h4>
</div>
<div id="outline-container-org61d8915" class="outline-4">
<h4 id="org61d8915">窗口</h4>
</div>
<div id="outline-container-orgd05c605" class="outline-4">
<h4 id="orgd05c605">文件</h4>
</div>
<div id="outline-container-orgf62a80d" class="outline-4">
<h4 id="orgf62a80d">文本</h4>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<div id='disqus_thread'></div>
                <script type='text/javascript'>
                    /* * * CONFIGURATION VARIABLES * * */
                    var disqus_shortname = 'callmesanye';
                    /* * * DON'T EDIT BELOW THIS LINE * * */
                    (function() {
                        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                    })();
                </script>
                <noscript>Please enable JavaScript to view the <a href='https://disqus.com/?ref_noscript' rel='nofollow'>comments powered by Disqus.</a></noscript>
                <p> Created by <a href="https://www.gnu.org/software/emacs/">Emacs</a> 25.3.1 (<a href="http://orgmode.org">Org</a> mode 9.1.3) </p>
                <a href='#' class='back-to-top' id='fixed-back-to-top' style='display: inline;'></a>
</div>
</body>
</html>
